{% extends 'core/base.html' %}
{% load static %}
{% block title %}Pizza Marketplace üçï{% endblock title %}

{% block content %}

<!-- üî• HERO -->
<section class="hero is-small" style="background: linear-gradient(120deg, #ff914d 0%, #ff4d4d 100%);">
  <div class="hero-body py-5">
    <div class="container has-text-centered" style="margin-top: -20px;">
      <h1 class="title is-2 has-text-white has-text-weight-bold mb-2">
        üçï Bienvenido al Marketplace de Pizzas
      </h1>
      <p class="subtitle is-5 has-text-light mb-3 mt-1">
        Descubre las mejores pizzas artesanales de tu pa√≠s
      </p>

      {% if not user.is_authenticated %}
      <div class="box p-4 has-text-centered"
           style="border-radius: 16px; max-width: 450px; margin: 0 auto;">
        <h2 class="title is-5 mb-3">Selecciona tu pa√≠s para comenzar üåé</h2>

        <form method="get" class="is-inline-block">
          <div class="select is-medium">
            <select name="country" onchange="this.form.submit()">
              <option value="">-- Elegir pa√≠s --</option>
              {% for country in countries %}
                <option value="{{ country.id }}"
                  {% if country.id|stringformat:"s" == selected_country|stringformat:"s" %}
                    selected
                  {% endif %}>
                  {{ country.name }}
                </option>
              {% endfor %}
            </select>
          </div>
        </form>

      </div>
      {% endif %}
    </div>
  </div>
</section>


<!--PRODUCTOS RECIENTES -->
<section class="section" style="background-color: #fdfdfd; margin-top: -60px;">
  <div class="container">

    <div class="has-text-centered mb-6">
      <h2 class="title is-2 has-text-dark mb-2">üî• √öltimos productos</h2>
      <p class="subtitle is-5 has-text-grey mt-1">
        Pizzas reci√©n salidas del horno
      </p>
      <hr class="is-centered" style="width: 80px; border: 2px solid #ff914d;">
    </div>

    <!-- üß† FILTRO DE PREFERENCIAS -->
    {% if user.is_authenticated and user.profile.preferences.count > 0 %}
    <div class="has-text-centered mb-5">
      {% if solo_pref %}
        <a href="?" class="button is-light is-rounded">
          üëÄ Ver todas las pizzas
        </a>
        <p class="has-text-grey mt-2">Mostrando solo pizzas seg√∫n tus preferencias üçÉ</p>
      {% else %}
        <a href="?solo_pref=1" class="button is-success is-light is-rounded">
          üå± Ver solo mis preferencias
        </a>
      {% endif %}
    </div>
    {% endif %}

    {% if newest_products %}
      <div class="columns is-multiline">
        {% for product in newest_products %}
        <div class="column is-3-desktop is-6-tablet">
          <div class="card product-card" style="border-radius: 16px; overflow: hidden;">

            <div class="card-image" style="position: relative;">
              <figure class="image is-4by3">
                <img src="{{ product.get_thumbnail }}" alt="{{ product.title }}">
              </figure>

              {% if product.active_offer %}
                {% if product.active_offer.is_2x1 %}
                  <span class="tag is-danger is-medium" 
                        style="position:absolute; top:10px; left:10px;">
                    üî• 2√ó1
                  </span>
                {% else %}
                  <span class="tag is-danger is-medium" 
                        style="position:absolute; top:10px; left:10px;">
                    üî• Oferta
                  </span>
                {% endif %}
              {% endif %}
            </div>

            <div class="card-content has-text-centered">
              <h3 class="title is-5 mb-2">{{ product.title }}</h3>

              <!-- üî• PRECIOS -->
              {% if product.active_offer %}

                {% if product.active_offer.is_2x1 %}
                  <p class="is-size-6 has-text-weight-semibold">
                    <span class="has-text-grey-light" style="text-decoration: line-through;">
                      {{ product.price }}
                    </span>
                    <br>
                    <span class="has-text-danger has-text-weight-bold is-size-5">
                      {{ product.get_final_price }} c/u (2√ó1)
                    </span>
                  </p>

                {% else %}
                  <p class="is-size-6 has-text-weight-semibold">
                    <span class="has-text-grey-light" style="text-decoration: line-through;">
                      {{ product.price }}
                    </span>
                    <br>
                    <span class="has-text-danger has-text-weight-bold is-size-5">
                      {{ product.get_final_price }}
                    </span>
                  </p>
                {% endif %}

              {% else %}
                <p class="is-size-6 has-text-weight-semibold">
                  {{ product.price }}
                </p>
              {% endif %}

              <a href="{% url 'product:product' product.category.slug product.slug %}"
                 class="button is-warning is-light is-small mt-3">
                Ver pizza üçï
              </a>
            </div>

          </div>
        </div>
        {% endfor %}
      </div>


    {% elif selected_country %}
      <div class="has-text-centered mt-6">
        <p class="has-text-grey">
          üö´ No hay productos disponibles en este pa√≠s por ahora.
        </p>
      </div>

    {% elif not user.is_authenticated %}
      <div class="has-text-centered mt-6">
        <p class="has-text-grey">
          Selecciona un pa√≠s para comenzar a ver pizzas.
        </p>
      </div>

    {% else %}
      <div class="has-text-centered mt-6">
        <p class="has-text-grey">No hay productos disponibles por el momento üçï</p>
      </div>
    {% endif %}
  </div>
</section>





<!-- üé® ESTILOS -->
<style>
  .product-card {
    transition: transform 0.25s ease, box-shadow 0.25s ease;
  }
  .product-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  }

  .hero.is-small {
    min-height: 35vh;
  }

  .hero-body {
    padding-top: 3rem !important;
    padding-bottom: 3rem !important;
  }

  section.section {
    position: relative;
    z-index: 10;
    border-top-left-radius: 24px;
    border-top-right-radius: 24px;
    box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.05);
  }
</style>

{% endblock content %}
