{% extends 'core/base.html' %}
{% load static %}
{% block title %}Pizza Marketplace 🍕{% endblock title %}

{% block content %}
<section class="hero is-small" style="background: linear-gradient(120deg, #ff914d 0%, #ff4d4d 100%);">
  <div class="hero-body py-5">
    <div class="container has-text-centered" style="margin-top: -20px;">
      <h1 class="title is-2 has-text-white has-text-weight-bold mb-2">
        🍕 Bienvenido al Marketplace de Pizzas
      </h1>
      <p class="subtitle is-5 has-text-light mb-3 mt-1">
        Descubre las mejores pizzas artesanales de tu país
      </p>

      {% if not user.is_authenticated %}
      <div class="box p-4 has-text-centered" style="border-radius: 16px; max-width: 450px; margin: 0 auto;">
        <h2 class="title is-5 mb-3">Selecciona tu país para comenzar 🌎</h2>
        <form method="get" class="is-inline-block">
          <div class="select is-medium">
            <select name="country" onchange="this.form.submit()">
              <option value="">-- Elegir país --</option>
              {% for country in countries %}
                <option value="{{ country.id }}" {% if country.id|stringformat:"s" == selected_country|stringformat:"s" %}selected{% endif %}>
                  {{ country.name }}
                </option>
              {% endfor %}
            </select>
          </div>
        </form>
      </div>
      {% endif %}
    </div>
  </div>
</section>

<section class="section" style="background-color: #fdfdfd; margin-top: -60px;">
  <div class="container">
    <div class="has-text-centered mb-6">
      <h2 class="title is-2 has-text-dark mb-2">🔥 Últimos productos</h2>
      <p class="subtitle is-5 has-text-grey mt-1">Pizzas recién salidas del horno</p>
      <hr class="is-centered" style="width: 80px; border: 2px solid #ff914d;">
    </div>

    {% if newest_products %}
      <div class="columns is-multiline">
        {% for product in newest_products %}
          <div class="column is-3-desktop is-6-tablet">
            <div class="card product-card" style="border-radius: 16px; overflow: hidden;">
              <div class="card-image">
                <figure class="image is-4by3">
                  <img src="{{ product.get_thumbnail }}" alt="{{ product.title }}">
                </figure>
              </div>
              <div class="card-content has-text-centered">
                <h3 class="title is-5 mb-2">{{ product.title }}</h3>
                <p class="is-size-6 has-text-weight-semibold">
                  {{ product.vendor.created_by.profile.country.currency_symbol }} {{ product.price }}
                </p>
                <a href="{% url 'product:product' product.category.slug product.slug %}"
                   class="button is-warning is-light is-small mt-3">
                  Ver pizza 🍕
                </a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% elif selected_country %}
      <div class="has-text-centered mt-6">
        <p class="has-text-grey">🚫 No hay productos disponibles en este país por ahora.</p>
      </div>
    {% elif not user.is_authenticated %}
      <div class="has-text-centered mt-6">
        <p class="has-text-grey">Selecciona un país para comenzar a ver pizzas.</p>
      </div>
    {% else %}
      <div class="has-text-centered mt-6">
        <p class="has-text-grey">No hay productos disponibles por el momento 🍕</p>
      </div>
    {% endif %}
  </div>
</section>

<style>
  /* 🌈 Tarjetas con animación suave */
  .product-card {
    transition: transform 0.25s ease, box-shadow 0.25s ease;
  }
  .product-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
  }

  /* 🎯 Hero más corto */
  .hero.is-small {
    min-height: 35vh;
  }

  .hero-body {
    padding-top: 3rem !important;
    padding-bottom: 3rem !important;
  }

  /* 🌟 Ajuste de la sección de productos */
  section.section {
    position: relative;
    z-index: 10;
    border-top-left-radius: 24px;
    border-top-right-radius: 24px;
    box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.05);
  }
</style>
{% endblock content %}
