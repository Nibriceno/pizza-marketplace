{% extends "core/base.html" %}

{% block content %}

<style>
  .history-page {
    max-width: 1100px;
    margin: 0 auto;
  }

  .history-header {
    margin-bottom: 18px;
  }

  .history-subtitle {
    font-size: 0.9rem;
    color: #666;
  }

  .history-card {
    background: #ffffff;
    border-radius: 16px;
    border: 1px solid #e5e7eb;
    box-shadow: 0 6px 14px rgba(15, 23, 42, 0.04);
    padding: 14px 16px;
  }

  .history-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    margin-bottom: 10px;
    font-size: 0.85rem;
    flex-wrap: wrap;
  }

  .history-link {
    font-size: 0.85rem;
  }

  .history-filter-form {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
  }

  .history-filter-form label {
    font-size: 0.8rem;
    color: #4b5563;
  }

  .history-filter-form input[type="date"] {
    font-size: 0.85rem;
    padding: 3px 6px;
    border-radius: 6px;
    border: 1px solid #d1d5db;
  }

  .btn-small {
    font-size: 0.8rem;
    padding: 4px 10px;
    border-radius: 999px;
    border: 1px solid #d1d5db;
    background: #f9fafb;
    cursor: pointer;
  }

  .btn-small-primary {
    background: #4f46e5;
    color: #fff;
    border-color: #4f46e5;
  }

  .btn-small-ghost {
    background: #ffffff;
  }

  .history-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
  }

  .history-table thead {
    background: #f9fafb;
  }

  .history-table th,
  .history-table td {
    padding: 8px 10px;
    border-bottom: 1px solid #e5e7eb;
    text-align: left;
    vertical-align: middle;
  }

  .history-table th {
    font-weight: 600;
    color: #4b5563;
    font-size: 0.85rem;
  }

  .history-table tr:last-child td {
    border-bottom: none;
  }

  .history-date {
    white-space: nowrap;
    font-weight: 600;
  }

  .history-dow {
    font-size: 0.8rem;
    color: #6b7280;
  }

  .history-product {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .history-thumb {
    width: 56px;
    height: 40px;
    border-radius: 8px;
    object-fit: cover;
    background: #f3f4f6;
    flex-shrink: 0;
  }

  .history-thumb-placeholder {
    width: 56px;
    height: 40px;
    border-radius: 8px;
    background: #f3f4f6;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    color: #9ca3af;
    flex-shrink: 0;
  }

  .history-product-title {
    margin: 0;
    font-weight: 600;
  }

  .history-product-price {
    margin: 0;
    font-size: 0.8rem;
    color: #6b7280;
  }

  .history-empty {
    text-align: center;
    padding: 24px 0;
    color: #9ca3af;
    font-size: 0.9rem;
  }

  .pagination {
    display: flex;
    justify-content: flex-end;
    gap: 6px;
    margin-top: 10px;
    font-size: 0.8rem;
    flex-wrap: wrap;
  }

  .pagination span,
  .pagination a {
    padding: 4px 8px;
    border-radius: 999px;
    border: 1px solid #e5e7eb;
  }

  .pagination .current {
    background: #4f46e5;
    color: #fff;
    border-color: #4f46e5;
  }

  .pagination a {
    text-decoration: none;
    color: #374151;
  }

  .pagination a:hover {
    background: #f3f4f6;
  }
</style>

<div class="history-page">

  <div class="history-header">
    <h2 class="mb-1">Histórico de menú semanal</h2>
    <div class="history-subtitle">
      Revisa qué pizza fue "pizza del día" en cada fecha. Puedes filtrar por rango de fechas.
    </div>
  </div>

  <div class="history-actions">
    <a href="{% url 'vendor:weekly_menu_edit' %}" class="history-link">
      ← Volver al menú de los próximos 7 días
    </a>

    <form method="get" class="history-filter-form">
      <label>
        Desde:
        <input type="date" name="from"
               value="{{ from_date|date:'Y-m-d' }}">
      </label>
      <label>
        Hasta:
        <input type="date" name="to"
               value="{{ to_date|date:'Y-m-d' }}">
      </label>
      <button type="submit" class="btn-small btn-small-primary">
        Filtrar
      </button>
      <a href="{% url 'vendor:weekly_menu_history' %}" class="btn-small btn-small-ghost">
        Últimos 30 días
      </a>
    </form>
  </div>

  <div class="history-card">
    {% if page_obj.object_list %}
      <table class="history-table">
        <thead>
          <tr>
            <th style="width: 140px;">Fecha</th>
            <th>Producto asignado</th>
          </tr>
        </thead>
        <tbody>
          {% for m in page_obj.object_list %}
            <tr>
              <td>
                <div class="history-date">
                  {{ m.date|date:"d/m/Y" }}
                </div>
                <div class="history-dow">
                  {{ m.date|date:"D" }}
                </div>
              </td>
              <td>
                <div class="history-product">
                  {% if m.product.thumbnail %}
                    <img src="{{ m.product.thumbnail.url }}"
                         alt="{{ m.product.title }}"
                         class="history-thumb">
                  {% elif m.product.image %}
                    <img src="{{ m.product.image.url }}"
                         alt="{{ m.product.title }}"
                         class="history-thumb">
                  {% else %}
                    <div class="history-thumb-placeholder">
                      Sin imagen
                    </div>
                  {% endif %}

                  <div>
                    <p class="history-product-title">{{ m.product.title }}</p>
                    <p class="history-product-price mb-0">
                      {% if m.product.price %}
                        ${{ m.product.price|floatformat:0 }}
                      {% else %}
                        Precio no definido
                      {% endif %}
                    </p>
                  </div>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="pagination">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}&from={{ from_date|date:'Y-m-d' }}&to={{ to_date|date:'Y-m-d' }}">&laquo; Anterior</a>
        {% endif %}

        <span class="current">
          Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}&from={{ from_date|date:'Y-m-d' }}&to={{ to_date|date:'Y-m-d' }}">Siguiente &raquo;</a>
        {% endif %}
      </div>
    {% else %}
      <div class="history-empty">
        No hay registros en el rango seleccionado.  
        Prueba con otro rango o vuelve a los últimos 30 días.
      </div>
    {% endif %}
  </div>

</div>

{% endblock %}
